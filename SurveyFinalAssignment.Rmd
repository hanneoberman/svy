---
title: "Understanding Society"
output: 
  html_notebook: 
    theme: paper
---

**Introduction**

The Innovation Panel is...

Multistage stratified cluster sampling was used...

Central to this research report are the following research questions: '...'. 

First we look at the sampling design and design weights, next population estimates are computed, and finally the effect of non-response on the estimates is investigated, as well as possible sources of non-response error.

The data:

```{r}
require(survey)
society <- readRDS("Understanding Society innovation pnel wave A.RDS")
society$a_dvage <- as.numeric(society$a_dvage)
head(society)
```

**Sampling Design**

"Include descriptions of your frame and target and population, intended sample size, and method of sample selection. Discuss potential non-sampling, sampling, and non-response errors" (Assignment 6, fox, 2018).

*1. The Innovation panel would interview multiple people from every household, but in the case households are very large, a Kish Grid is used. Can you explain why the Kish Grid is a popular method to do within-household selection of respondents?*


The Kish Grid method is used to select respondents in a household at random. This method considered to lead to a random sample of household members, and avoids selection bias in the survey. 

It is a popular method because when carried out correctly, it leads to (almost) equal probability sampling, something other selection methods do not obtain. Moreover, the only information you need in order to select respondents is a list containing the names of the persons in the household you want to sample. 


**Design Weights**

*2. Despite the complex data structure, the design weights as included in the variable "a_psnenip_xd" have a very low variance. Can you explain why this is the case?*
As the following table shows, the variance in the design weight variable is ...
```{r} 
Var. <- var(society$a_psnenip_xd) #compute variance in the design weight variable
Descr. <- cbind(t(summary(society$a_psnenip_xd)), Var.) #combine with other descriptive statistics
round(Descr., 2) #print with only two decimals
```
The low variance is due to rescaling of the weights, as explained in the IP User Guide (p. 56): "Each set of weights has been scaled by a constant factor to produce a mean of one amongst cases eligible to receive the weight". Rescaling, truncating, or smoothing of weights are techniques to inhibit the effect of a single observation on population estimates (Lohr, **year**). 

Lower MSE (Lohr, p. 286), and application from IP User Guide.

*3. Apart from the design weight, an enumerated design weight "a_psnenip_xw" is also included. Please show using syntax in R how you can calculate this weight.*
```{r}
# None of the age groups have 7 groups
# Too many levels, have to find groups
levels(society$a_gor_dv)
# Calculate household weight (or use design weight?)
# Calculate weight post-stratified for sex, age and government region.
```


**Population Esitimates**
*4. What is the proportion of employed people of working age (15-64) in the population?*
```{r}
# First, we investigate the a_employ variable.
levels(society$a_employ[society$a_dvage > 15 & society$a_dvage < 64])
# The variable a_employ has seven levels.
summary(society$a_dvage[society$a_employ=="yes"])
summary(society$a_dvage[society$a_employ=="no"])
# Yes and no contain people of over 21 years of age.
society[society$a_employ=="missing",]
# Missing does not appear in the data
society[society$a_employ=="inapplicable",]
# Inapplicable seems to contain all children and youths of 21 years and younger
# It cannot be assumed that none of them is employed. It can however be assumed that only a
# small part of them is employed, as children under 15 cannot legally work.
society[society$a_employ=="proxy respondent",]
# No rows returned
society[society$a_employ=="refuse",]
society[society$a_employ=="don\'t know",]
# Both refuse and don't know contain one row. These can be treated as missing data.

# Thus, our goal is to compare the proportion of employed people (yes) of working age against 
# the number of unemployed people (no, inapplicable), excluding the missing data (refuse, don't know)

society$a_dvage <- as.numeric(society$a_dvage)
with(society, society[a_employ=="yes" & a_dvage >64,])
# There are people older than 64 still working, we should take those out. 
with(society, society[a_employ=="yes" & a_dvage <15,])
# No one younger than 15 years is reported to be working, which is to be expected as it was not
# a question asked to people under 21 years of age.

# Since we wish to know the proportion of employed people of working age, we need 2 groups, one with employed adults and one with unemployed adults and employed elderly.
society$employ_dv <- as.numeric(0)
society$employ_dv[society$a_employ=='yes' & society$a_dvage <= 65] <- 1

# Now we can calculate the proportion
Design <- svydesign(ids=~a_hidp, strata=~a_strata, data=society, weights=~a_psnenip_xw)
Nonmiss <- with(Design, subset(Design, a_employ!="refuse" & a_employ!="don\'t know"))
svymean(~employ_dv, Design)
# 43,3% of the population is employed.

# Add 95% CI for the estimate.
```

*5. Please investigate the relationship between age and household composition for the population of Great Britain.*

*a. Investigate which age variable you should use*
For householdcomposition, with/without children is key.
Therefore, young children's ages do not matter as much, but 15-20 is expected to have more variance and should thus be over-sampled.


*b. Construct a new variable "household_composition" from the following four variables: "a_livesp_dv, a_cohab_dv, a_single_dv, a_mastat_dv".*
Household composition: 

First, create variable household size:
```{r}
# Household size: count for each household, how many persons there are in. 
# a_hidp - Household identifier
count <- as.matrix(table(society$a_hidp)) # number of occurences of each a_hidp (indicator of size of household)
summary(count)

# create variable to assign household size to each individual person 
society$household_size <- NA 
for (i in rownames(count)) { # for each household..
  society$household_size[society$a_hidp == i] <- count[i,] # maybe this can be written into nicer R code. 
}

# household_type 
# number of children (according to eurostat properties..)
```

Couple (with/without children)
Single adult (with/without children)
Other type of household (with/without children)

Household information data
a_marstat - Legal marital status
a_livesp - Living with spouse
a_livewith - Living as part of a couple in household
a_adresp15 - Adult responsible for child age < 15
a_adresp17 - Adult responsible for child age < 17
a_livesp_dv - Living with spouse
a_cohab_dv - Living with cohabitee
a_single_dv - Single in household
a_mastat_dv - De facto marital status
a_depchl_dv - Whether person is a dependent child
a_rach16_dv - Whether responsible for a child under 16
a_respm16_dv - Whether natural/adoptive/step mother of child under 16
a_respf16 dv - Whether natural/adoptive/step father of child under 16
a_nchild_dv - Number of own children in household
a_ndepchl_dv - Number of own dependent children in household

*c.Which weight should you use here?*
For this analysis, we want to use a weight per person (PSN), as it is impossible to calculate age per household. We also want to use the enumeration grid weights (EN), as both age and household composition have no missing values. We want the weights of the first wave (IP), as that is the one we are investigating. Finally, we want to use the stratified weights (XW) rather than the design weights, as we are investigating population values and not sample values. Thus, we want to use the weight a_psnenip_xw, as this is the only weight that covers the correct data in the correct way.

*Lastly, compute population correlation estimate.*


**Non-response**

*6. Not all sample members you included in questions 1-5 participated in the survey. Use the variable "a_ivfio" to investigate how many people personally conducted an interview.*

```{r}
summary(society$a_ivfio) #what's in the variable?
adults <- sum(society$a_ivfio == "Full interview") #the full interviews with adults
youths <- sum(society$a_ivfio ==  "Youth Interview") #the interviews with children
sum(adults, youths) #all personally completed interviews
```

*7. Repeat your analysis under question 4. Use only the people who personally did an interview. What is your conclusion? Is there a difference between respondents and nonrespondents when it comes to their employment?*


*8. Using only variables from this dataset, can you find variables which could potentially be useful for constructing nonresponse weights? Why these variables?*
Nonresponse can seriously threat the quality of estimates if the nonresponders differ from the responders in the study. We can adjust for this by the use of auxiliary variables that hold information about the entire sample. We can compare the distribution of the auxiliary variables of the population with its response distribution, and assess whether the response is representative for the whole population. 

If the distributions differ, we must conclude that nonresponse has lead to a nonrepresentative sample. We can adjust for this by constructing nonresponse weights from the auxiliary variables. Then the weighted sample is representative with respect to the auxiliary variables used. 

/Schouten (2007) says: We propose a selection strategy of weighting variables that minimises the width of the bias interval. The strategy is a forward inclusion-backward elimination algorithm of auxiliary variables similar to algorithms applied in regression analysis. Variables are included or eliminated based on jackknife estimates of the mean and standard deviation of the change in interval width. 
"We propose a selection strategy of weighting variables that minimises the width of the bias interval. The strategy is a forward inclusion-backward elimination algorithm of auxiliary variables similar to algorithms applied in regression analysis. Variables are included or eliminated based on jackknife estimates of the mean and standard deviation of the change in interval width./

/The IP User Guide states "that all models used to predict response propensities as described in the Technical Details are fitted using stepwise backward logistic regression with p=0.05."
???Note that all models used to predict response propensities as described in the Technical Details are fitted using stepwise backward logistic regression with p=0.05. Each set of weights has been scaled by a constant factor to produce a mean of one amongst cases eligible to receive the weight. In consequence, weights which are defined as equal (e.g. D_HHDENIP_XW AND D_PSNENIP_XW for the refreshment sample) will not necessarily have the same numeric value, but will retain the same between-person/household relative value??? (IP User Guide, p. 56). /

Steps we want to undertake:
1. Identify nonresponse
2. Come up with strategy to identify useful auxiliary variables
3. Select auxiliary variables 

?need to compare every auxiliary variable individually? 

First, we need to divide the population in the respondents and nonrespondents
There are two stages of nonresponse here: 
* individual nonresponse: whether a personal interview was conducted yes or no
* household nonresponse: defined as completian of at least the household grid 

```{r}
society$person_response <- society$a_ivfio ==  "Youth Interview" | society$a_ivfio == "Full interview" # indicator of whether person conducted a personal interview (response)
1-mean(society$person_response) # proportion of individual nonresponse
levels(society$a_hhresp_dv) # looks like all households at least filled in the grid. 
```
Individual nonresponse is 26.2%
It looks like household nonresponse cannot be identified in this dataset. The levels of variable A_hhresp_dv suggests that all households at least completed the household grid (maybe this is the case for wave 1?). According to user guide, this respons should be 1about 59%. CHECK. For now, we only take into account individual nonresponse. If available it could also be interesting to use household nonresponse as a potentially useful auxiliary variable. 

/Person response: 
The enumerated person weight (A_PSNENIP_XW) is defined for all persons in
households that participated in IP1. The weight equals the IP1 household weight,
post-stratified by age, sex, and grouped Government Office Region. The post-
stratification targets are taken from Office for National Statistics 2008 mid-year
population statistics. /

Second, we want to come up with a strategy in how to select the most appropriate auxiliary variables to construct nonresponse weights. There are several ways to do this: 
- algorithm 
- statistical (stepwise) logistic regression: which auxiliary variables are best in predicting individual nonresponse. 
- user guide indicates sex and gender as auxiliary variables. Women and older people are more prone to respond.  

Third, we apply selection strategy:
```{r}
auxiliaries <- subset(society, select = c("a_hidp")) #matrix of all possible auxiliary variables 
```
? don't include weights in svy_design as well when doing logistic regression because they're already corrected for nonresponse..? or aren't they? 

Identifiers of person
a_gor_dv - Government office region
a_urban_dv - Urban or rural area, derived

Personal data
a_sex - Sex
a_racel_dv - Ethnic group
a_employ - employment status
a_ageest - Estimated age
a_ageif - Age last birthday
a_dvage - Age for whole sample
a_agegr5_dv - Age group: 5-year intervals
a_agegr10_dv - Age group: 10-year intervals
a_agegr13_dv - Age group: 13 categories

Household information data
a_marstat - Legal marital status
a_livesp - Living with spouse
a_livewith - Living as part of a couple in household
a_adresp15 - Adult responsible for child age < 15
a_adresp17 - Adult responsible for child age < 17
a_livesp_dv - Living with spouse
a_cohab_dv - Living with cohabitee
a_single_dv - Single in household
a_mastat_dv - De facto marital status
a_depchl_dv - Whether person is a dependent child
a_rach16_dv - Whether responsible for a child under 16
a_respm16_dv - Whether natural/adoptive/step mother of child under 16
a_respf16 dv - Whether natural/adoptive/step father of child under 16
a_nchild_dv - Number of own children in household
a_ndepchl_dv - Number of own dependent children in household

Interview data
a_hhresp_dv - Household response status

**References**
Lohr, S. (2010). Sampling: Design and Analysis (second edition). Brooks/Cole, Boston, USA.